extends ../../layout/default.pug
include ../../mixins/page_header.pug
include ../../mixins/toolbar_filter.pug
include ../../mixins/toolbar_handle.pug
include ../../mixins/deletion_warning.pug
block main 
    +page_header("Danh sách sản phẩm đã xóa", [
        { name: "Sản phẩm", href: `${PATH_ADMIN}/product` },
        { name: "Thùng rác", href: `${PATH_ADMIN}/product-trash` },
    ])
    div(class="toolbar")
        div(class="toolbar__box")
            div(class="toolbar__left-box")
                form(action=`${PATH_ADMIN}/product-trash`, method="GET") 
                    div(class="search")
                        input(class="search__input", type="text", name="name",placeholder="Nhập từ khóa tìm kiếm", spellcheck="false")
                        button(type="submit" class="search__toolbar-icon")
                            i(class="fa-solid fa-magnifying-glass")
                button(id="advanced-filter-btn", class="advanced-filter-btn btn btn-primary", type="button")
                    span(class="search__filter-icon")
                        i(class="fa-solid fa-filter")
                    | Bộ Lọc
                button(id="advanced-handle-btn", class="advanced-handle-btn btn btn-primary", type="button")
                    span(class="search__filter-icon")
                        i(class="fa-solid fa-sliders")
                    | Nâng cao
                a(href=`${PATH_ADMIN}/product`, class="back-btn btn btn-primary")
                    span(class="search__filter-icon")
                        i(class="fa-solid fa-reply")
                    | Quay lại
            div(class="toolbar__right-box")
                a(href=`${PATH_ADMIN}/product`,class="trash-btn btn btn-primary")
                    span(class="product__list-icon")
                        i(class="fa-regular fa-rectangle-list")
                    | Danh sách sản phẩm
        +toolbarFilter(filter,"product-trash")
        +toolbarHandle(handle,"product-trash",true)

    div(class="overview-block") 
        div(class="overview-item total-products")
            h3(class="overview-item__title total-products__title") Tổng số sản phẩm
            p(class="overview-item__detail total-products__detail") #{general.totalProduct}
        div(class="overview-item inventory")
            h3(class="overview-item__title inventory__title") Tồn kho
            p(class="overview-item__detail inventory__detail") #{general.inventory}
        div(class="overview-item out-of-stock")
            h3(class="overview-item__title out-of-stock__title") Hết hàng
            p(class="overview-item__detail out-of-stock__detail") #{general.outOfStock}
        div(class="overview-item inventory-value")
            h3(class="overview-item__title inventory-value__title") Giá trị hàng tồn
            p(class="overview-item__detail inventory-value__detail") #{general.inventoryTotalValue.toLocaleString('vi-VN')}đ

    div(class="list-product")
         table(class="list-product__table")
            thead
                tr
                th(scope="col") 
                    input(type="checkbox" name="sort" id="product-item__select-all" value="1")
                th(scope="col") 
                    |   Tên sản phẩm
                    !=pugHepper.sort("name", _sort)
                th(scope="col") 
                    |   Mã sản phẩm
                    !=pugHepper.sort("code", _sort)
                th(scope="col") Danh mục
                th(scope="col") 
                    |   Giá gốc
                    !=pugHepper.sort("original_price", _sort)
                th(scope="col") 
                    |   Giá bán
                    !=pugHepper.sort("price", _sort)
                th(scope="col") 
                    |   giảm giá
                    !=pugHepper.sort("discount", _sort)
                th(scope="col") 
                    |   Tồn kho 
                    !=pugHepper.sort("inventory", _sort)
                th(scope="col") Trạng thái 
                th(scope="col")  
                th(scope="col")
            tbody
                if listDeletedProduct.length > 0
                    each product in listDeletedProduct
                        tr
                            td 
                                input(type="checkbox" class="product-item__select" name="sort" id-product=product._id value="1")
                            td  
                                div(class="product-item__name")
                                    - var thumbnail = product.thumbnails?.[0] || "/uploads/default-image.jpg"
                                    img(class="product-item__img", src=thumbnail, alt=product.name)
                                    h4(class="product-item__title") #{product.name}
                            td 
                                p 
                                    span(class="product-item__icon")
                                        i(class="fa-solid fa-tag" style="transform: scaleX(-1)")
                                    | #{product.code}
                            td 
                                p #{product.category}
                            
                            td 
                                p(class="product-item__original_price")
                                    |   #{product.original_price.toLocaleString('vi-VN')}đ
                                    span(class="product-item__icon product-item__icon-pen")
                                        i(class="fa-solid fa-pen")
                                input(class="product-item__input", type="number", value=product.original_price,field="original_price",_id=product._id)
                                form(action="", method="post") 

                            td 
                                p(class="product-item__price")
                                    |   #{product.price.toLocaleString('vi-VN')}đ
                                    span(class="product-item__icon product-item__icon-pen")
                                        i(class="fa-solid fa-pen")
                                input(class="product-item__input", type="number", value=product.price, field="price",_id=product._id)
                                form(action="", method="post") 


                            td 
                                p(class="product-item__discount") #{product.discount}%

                            td 
                                p(class="product-item__inventory") #{product.inventory}
                            
                            td 
                                div(class="btn-status")
                                    div(class="btn-status-toggle")
                                            div(class="form-check form-switch")
                                                input(class="form-check-input btn-status__input", type="checkbox", role="switch",checked=product.status == "on",_id=product._id)
                                    p(class="btn-status__desc") Hoạt động          

                            td 
                                form(method="POST", action=`${PATH_ADMIN}/product-trash/restore-product/${product._id}?_method=PATCH`)
                                    button(type="submit", class="btn-restore btn") Khôi phục  
                            td 
                                button(type="button", class="btn-destroy btn btn-danger",data-bs-toggle="modal",data-bs-id = product._id, data-bs-target="#warningDeleteModal") Xóa vĩnh viễn  
                else  
                    tr 
                        td(colspan="9")
                            p(class="noProducts") Không có sản phẩm nào đã xóa!   
                            a(class="noProducts__link", href=`${PATH_ADMIN}/product`) Danh sách sản phẩm.


    form(method="POST", type="hidden",id="form-product-delete" ,action=``)
    <!-- Modal -->
    +formWarning("warningDeleteModal","Bạn có chắc chắn muốn <b class='warning-text'>Xóa Vĩnh Viễn</b> sản phẩm này không?<span class='warning-text'> Hành động này không thể hoàn tác!!!</span>","warning-delete-modal-btn","Xóa Vĩnh Viễn")